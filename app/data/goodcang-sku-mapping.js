/**
 * 谷仓商品SKU映射表
 * 商品编码 -> 谷仓商品条码
 * 用于小样发货时自动匹配谷仓商品
 */

export const goodcangSkuMapping = {
  "BRYNNA-OY16": "G11826-P8274582586",
  "ARLISE-OY12": "G11826-G3712897241",
  "EVE-1802-7": "G11826-B2504691911",
  "EVE-1802-6": "G11826-L1424314917",
  "EVE-1802-4": "G11826-E5211218814",
  "EVE-1802-1": "G11826-D9878856066",
  "LYRA-CLOUD-21": "G11826-R1434516803",
  "LYRA-CLOUD-14": "G11826-G8623300732",
  "LYRA-CLOUD-10": "G11826-Z6027538957",
  "LYRA-CLOUD-6": "G11826-X0599692274",
  "LYRA-CLOUD-1": "G11826-S6850102937",
  "LYRA-CLOUD-3": "G11826-S1270186042",
  "ARIA-HJ9022-3-23": "G11826-G3723115744",
  "ARIA-HJ9022-3-31": "G11826-R8219794096",
  "ARIA-HJ9022-3-6": "G11826-T6018861337",
  "ARIA-HJ9022-3-10": "G11826-Z4555760275",
  "NINA-2020-11": "G11826-D1946094163",
  "NINA-2020-16": "G11826-Z3340691810",
  "NINA-2020-5": "G11826-E2965716431",
  "NINA-2020-9": "G11826-U7943450229",
  "NINA-2020-3": "G11826-J1625312424",
  "ZARA-1802-7": "G11826-N9024420495",
  "ZARA-1802-6": "G11826-L3033901587",
  "ZARA-1802-4": "G11826-S2653564641",
  "ZARA-1802-1": "G11826-I8870459414",
  "LUNA-A5018-31": "G11826-I3683838792",
  "LUNA-A5018-69": "G11826-U3234763868",
  "LUNA-A5018-76": "G11826-C8841254349",
  "LUNA-A5018-52": "G11826-D8237090401",
  "LUNA-A5018-41": "G11826-D3989153457",
  "LUNA-A5018-28": "G11826-T5383611258",
  "LUNA-A5018-05": "G11826-P0234616477",
  "LUNA-A5018-14": "G11826-X6254851970",
  "LUNA-A5018-34": "G11826-V5291215426",
  "LUNA-A5018-11": "G11826-L9659070036",
  "LUNA-A5018-39": "G11826-J4436640102",
  "LUNA-A5018-01": "G11826-U4021424496",
  "IRIS-2852-19": "G11826-X3496898737",
  "FAYE-8011-9": "G11826-Z3102053715",
  "FAYE-8011-32": "G11826-L9379987955",
  "FAYE-8011-18": "G11826-W1604863363",
  "FAYE-8011-7": "G11826-E7071589708",
  "FAYE-8011-10": "G11826-S2140671154",
  "FAYE-8011-14": "G11826-T7780050614",
  "NOVA-22": "G11826-N4839619483",
  "NOVA-19": "G11826-W4301925299",
  "NOVA-27": "G11826-W0618911564",
  "NOVA-11": "G11826-K8705785082",
  "NOVA-6": "G11826-C4795484479",
  "NOVA-3": "G11826-C6006239406",
  "NOVA-1": "G11826-M3991823441",
  "MIRA-6320-22": "G11826-K4109891477",
  "MIRA-6320-15": "G11826-Q7590219328",
  "MIRA-6320-9": "G11826-P4579583748",
  "MIRA-6320-8": "G11826-Z3061432518",
  "MIRA-6320-12": "G11826-F7327843982",
  "MIRA-6320-7": "G11826-M8729543560",
  "MIRA-6320-13": "G11826-L5246312436",
  "MIRA-6320-4": "G11826-Z8826079227",
  "MIRA-6320-1": "G11826-Y9033284616",
  "MARINA-868-19": "G11826-D3050066247",
  "MARINA-868-27": "G11826-C1515081752",
  "MARINA-868-36": "G11826-D4788890881",
  "MARINA-868-38": "G11826-T9388224074",
  "MARINA-868-76": "G11826-Z3327262051",
  "MARINA-868-2": "G11826-A8749157879",
  "MARINA-868-60": "G11826-S9391362003",
  "MARINA-868-15": "G11826-I0167522275",
  "MARINA-868-1": "G11826-K9511965472",
  "SERAPHINE-9013-31": "G11826-Q7544740248",
  "SERAPHINE-9013-7": "G11826-Z8552168785",
  "SERAPHINE-9013-8": "G11826-M3381429772",
  "SERAPHINE-9013-20": "G11826-Y3083108159",
  "SERAPHINE-9013-24": "G11826-Q2291704741",
  "SERAPHINE-9013-13": "G11826-J1334163379",
  "SERAPHINE-9013-12": "G11826-L2996926101",
  "SERAPHINE-9013-3": "G11826-R7066313156",
  "SERAPHINE-9013-27": "G11826-H4244184678",
  "SERAPHINE-9013-1": "G11826-G1200855285",
  "SERAPHINE-9013-0": "G11826-Y6244927988",
  "SERAPHINE-9013-2": "G11826-V3740279821",
  "SERAPHINE-9013-21": "G11826-Y7237783642",
  "AZALEA-2026-3": "G11826-L1925511582",
  "AZALEA-2026-5": "G11826-Y0867044904",
  "AZALEA-2026-13": "G11826-K0942349741",
  "AZALEA-2026-4": "G11826-T4886403400",
  "AZALEA-2026-11": "G11826-T7280318194",
  "AZALEA-2026-10": "G11826-L4502322362",
  "MARISOL-K1020": "G11826-L3294256070",
  "MARISOL-K1019": "G11826-M7896073132",
  "MARISOL-K1018": "G11826-T7198073841",
  "MARISOL-K1015": "G11826-Y8956528749",
  "MARISOL-K1014": "G11826-U2147026428",
  "MARISOL-K1013": "G11826-L9344389335",
  "MARISOL-K1012": "G11826-T7757609505",
  "MARISOL-K1011": "G11826-Q8430094319",
  "EMILIA1908-35": "G11826-Z7085223052",
  "EMILIA1908-33": "G11826-Y4918077012",
  "EMILIA1908-29": "G11826-S4531349764",
  "EMILIA1908-12": "G11826-B5163825157",
  "EMILIA1908-11": "G11826-S1799837196",
  "EMILIA1908-6": "G11826-X4825996226",
  "EMILIA1908-5": "G11826-Q6226527103",
  "EMILIA1908-4": "G11826-A9021869303",
  "EMILIA1908-1": "G11826-W4002451629",
  "EMILIA1908-0": "G11826-K7662032997",
  "ELOWEN7084-60": "G11826-T2771010806",
  "ELOWEN7084-59": "G11826-V5864038541",
  "ELOWEN7084-35": "G11826-G8873544877",
  "ELOWEN7084-25": "G11826-R1446442209",
  "ELOWEN7084-16": "G11826-Y5122782170",
  "ELOWEN7084-11": "G11826-J8947471477",
  "ELOWEN7084-6": "G11826-G3788121149",
  "ELOWEN7084-4": "G11826-H5054584228",
  "ELOWEN7084-3": "G11826-D7524307316",
  "ELOWEN7084-2": "G11826-W4188203062",
  "ELOWEN7084-1": "G11826-H5824975470",
  "ELOWEN7084-0": "G11826-E0616919876",
  "SORAYA158-14": "G11826-F0309562879",
  "SORAYA158-28": "G11826-F8624622572",
  "SORAYA158-67": "G11826-T5328160520",
  "SORAYA0017-47": "G11826-X5591565821",
  "CALISTA919-15": "G11826-D9586278933",
  "CALISTA919-11": "G11826-V8244112144",
  "CALISTA919-43": "G11826-J2332277183",
  "CALISTA919-35": "G11826-X3291099710",
  "CALISTA919-21": "G11826-N4967218492",
  "CALISTA919-02": "G11826-K1560907370",
  "CALISTA919-01": "G11826-C7665979058",
  "CALISTA919-7": "G11826-H2319871198",
  "CALISTA919-22": "G11826-R7949842779",
  "CALISTA919-45": "G11826-R4975794033",
  "CALISTA919-49": "G11826-Y3857756625",
  "EMILIA-CLOUD-21": "G11826-G5677123970",
  "EMILIA-CLOUD-14": "G11826-J7047644348",
  "EMILIA-CLOUD-10": "G11826-G3700311205",
  "EMILIA-CLOUD-6": "G11826-K3369639686",
  "EMILIA-CLOUD-1": "G11826-P7378703139",
  "EMILIA-CLOUD-3": "G11826-E4940659692",
  "ISADORA-OY6-238-10": "G11826-R0356306063",
  "ISADORA-OY6-238-9": "G11826-E6773820294",
  "ISADORA-OY6-238-4": "G11826-L4488959535",
  "ISADORA-OY6-238-5": "G11826-Z3141796812",
  "ISADORA-OY6-238-1": "G11826-C9211625549",
  "ISADORA-OY6-238-3": "G11826-Z1748331595",
  "ISADORA-OY6-238-11": "G11826-V3695272266",
  "ISADORA-OY6-238-21": "G11826-S0172678120",
  "ISADORA-OY6-238-24": "G11826-V2938561030",
  "ISADORA-OY6-238-25": "G11826-U2041265384",
  "ISADORA-OY6-238-26": "G11826-Y9389418760",
  "SELENE-J803-2": "G11826-H6550091202",
  "SELENE-J803-81": "G11826-Y8652174493",
  "SELENE-J803-79": "G11826-F8633043999",
  "SELENE-J803-77": "G11826-U6593662064",
  "SELENE-J803-49": "G11826-C1982030119",
  "SELENE-J803-55": "G11826-K8818938532",
  "SELENE-J803-58": "G11826-K3367032578",
  "SELENE-J803-73": "G11826-A4484888258",
  "SELENE-J803-120": "G11826-Y0723765677",
  "SELENE-J803-106": "G11826-V0813322170",
  "SELENE-J803-20": "G11826-C3010453291",
  "SELENE-J803-8": "G11826-W1817612126",
  "SELENE-J803-14": "G11826-W8715661612",
  "SELENE-J803-7": "G11826-R9887159504",
  "SELENE-J803-4": "G11826-V2997355617",
  "SELENE-J803-3": "G11826-K1139038463",
  "SELENE-J803-1": "G11826-M0810577990",
  "VERONA-B36": "G11826-E0652408746",
  "VERONA-B14": "G11826-K7639861114",
  "VERONA-B33": "G11826-I9792331616",
  "VERONA-B40": "G11826-S3103888524",
  "VERONA-B31": "G11826-D5567805072",
  "VERONA-B11": "G11826-M8197704276",
  "VERONA-B3": "G11826-Q6435508072",
  "VERONA-B1": "G11826-M2509868159",
  "FIORA-MBH9520-38": "G11826-Z1681418335",
  "FIORA-MBH9520-33": "G11826-U2142083453",
  "FIORA-MBH9520-30": "G11826-Q2851335722",
  "FIORA-MBH9520-29": "G11826-U8978202910",
  "FIORA-MBH9520-28": "G11826-C8598245182",
  "FIORA-MBH9520-22": "G11826-H1720670422",
  "FIORA-MBH9520-20": "G11826-H4166196287",
  "FIORA-MBH9520-18": "G11826-T9007849662",
  "FIORA-MBH9520-17": "G11826-B6657184118",
  "FIORA-MBH9520-13": "G11826-B2838076184",
  "FIORA-MBH9520-12": "G11826-I1221386640",
  "FIORA-MBH9520-10": "G11826-V0212612206",
  "FIORA-MBH9520-9": "G11826-M6765828941",
  "FIORA-MBH9520-8": "G11826-L8400301002",
  "FIORA-MBH9520-7": "G11826-C5660329123",
  "FIORA-MBH9520-5": "G11826-R4566196499",
  "FIORA-MBH9520-4": "G11826-H8109752297",
  "FIORA-MBH9520-3": "G11826-A1154973718",
  "FIORA-MBH9520-2": "G11826-M2277741765",
  "FIORA-MBH9520-1": "G11826-T7488097284",
  "ORINDA-KLQ2-15": "G11826-B8439263500",
  "ORINDA-KLQ2-14": "G11826-I0459108725",
  "ORINDA-KLQ2-13": "G11826-E2855069945",
  "ORINDA-KLQ2-12": "G11826-I0276291813",
  "ORINDA-KLQ2-11": "G11826-I6532865390",
  "ORINDA-KLQ2-10": "G11826-C0623414326",
  "ORINDA-KLQ2-9": "G11826-H1566224198",
  "ORINDA-KLQ2-8": "G11826-F0994430999",
  "ORINDA-KLQ2-7": "G11826-N3604440752",
  "ORINDA-KLQ2-6": "G11826-Q9644916528",
  "ORINDA-KLQ2-5": "G11826-Q9003287610",
  "ORINDA-KLQ2-4": "G11826-X8998344349",
  "ORINDA-KLQ2-3": "G11826-S3039222758",
  "ORINDA-KLQ2-2": "G11826-C4731373703",
  "ORINDA-KLQ2-1": "G11826-G4091014863",
  "LIORA658-44": "G11826-R1531942030",
  "LIORA658-43": "G11826-F0450376687",
  "LIORA658-41": "G11826-L7637632444",
  "LIORA658-40": "G11826-C9643683505",
  "LIORA658-37": "G11826-S6587301452",
  "LIORA658-31": "G11826-B8132488047",
  "LIORA658-29": "G11826-J6585823809",
  "LIORA658-25": "G11826-V1848993608",
  "LIORA658-17": "G11826-L8914093253",
  "LIORA658-16": "G11826-I4373893090",
  "LIORA658-15": "G11826-A8704650202",
  "LIORA658-14": "G11826-D3559836062",
  "LIORA658-12": "G11826-I4254232493",
  "LIORA658-11": "G11826-F7483445651",
  "LIORA658-10": "G11826-E1349455003",
  "LIORA658-9": "G11826-Z4171898029",
  "LIORA658-8": "G11826-A3103440344",
  "LIORA658-7": "G11826-K2636352855",
  "LIORA658-6": "G11826-J5779855640",
  "LIORA658-5": "G11826-R2719614316",
  "LIORA658-4": "G11826-J7291466084",
  "LIORA658-3": "G11826-L9388971772",
  "LIORA658-2": "G11826-J8207384263",
  "LIORA658-1": "G11826-N0828601176",
  "ELARA89850-37": "G11826-D0493337126",
  "ELARA89850-36": "G11826-I5219161431",
  "ELARA89850-35": "G11826-M8686781927",
  "ELARA89850-34": "G11826-F3195392768",
  "ELARA89850-33": "G11826-H7323344373",
  "ELARA89850-31": "G11826-S5033014943",
  "ELARA89850-29": "G11826-S6979420302",
  "ELARA89850-28": "G11826-A4940280698",
  "ELARA89850-20": "G11826-X0686411614",
  "ELARA89850-19": "G11826-P2537444115",
  "ELARA89850-18": "G11826-D8985116495",
  "ELARA89850-17": "G11826-D2175680435",
  "ELARA89850-16": "G11826-B7805340622",
  "ELARA89850-14": "G11826-R4103889175",
  "ELARA89850-13": "G11826-C4215434840",
  "ELARA89850-12": "G11826-S0016669457",
  "ELARA89850-11": "G11826-W7642320500",
  "ELARA89850-10": "G11826-R1210214290",
  "ELARA89850-9": "G11826-A7250244248",
  "ELARA89850-8": "G11826-W5592074862",
  "ELARA89850-7": "G11826-V6910719010",
  "ELARA89850-5": "G11826-V0547521894",
  "ELARA89850-4": "G11826-D6630752697",
  "ELARA89850-3": "G11826-Q1634975517",
  "ELARA89850-2": "G11826-M9273752851",
  "ELARA89850-1": "G11826-Z4292809163",
  "ELARA89850-0": "G11826-B2710007028",
  "AMARA1038-28": "G11826-N0665505334",
  "AMARA1038-27": "G11826-J8443468568",
  "AMARA1038-26": "G11826-V3430834677",
  "AMARA1038-23": "G11826-C2249045433",
  "AMARA1038-22": "G11826-F8030359995",
  "AMARA1038-21": "G11826-C5478805441",
  "AMARA1038-20": "G11826-F3004453021",
  "AMARA1038-19": "G11826-E2815692977",
  "AMARA1038-18": "G11826-H5569300012",
  "AMARA1038-17": "G11826-H3053469801",
  "AMARA1038-16": "G11826-Y4967167886",
  "AMARA1038-15": "G11826-J6193329056",
  "AMARA1038-14": "G11826-C3790738508",
  "AMARA1038-13": "G11826-D3374851275",
  "AMARA1038-12": "G11826-S1338730681",
  "AMARA1038-11": "G11826-F8266521389",
  "AMARA1038-10": "G11826-T0202104333",
  "AMARA1038-9": "G11826-B4210169038",
  "AMARA1038-8": "G11826-G3686598691",
  "AMARA1038-7": "G11826-N6600059928",
  "AMARA1038-6": "G11826-E0724988117",
  "AMARA1038-5": "G11826-C8019291890",
  "AMARA1038-4": "G11826-F8844251195",
  "AMARA1038-3": "G11826-L6563853098",
  "AMARA1038-2": "G11826-Y0585727653",
  "AMARA1038-1": "G11826-F7013741001",
  "CELINA8823-15": "G11826-Y2316045431",
  "CELINA8823-17": "G11826-I6119849315",
  "CELINA8823-26": "G11826-N4440967665",
  "CELINA8823-20": "G11826-M8026382468",
  "CELINA8823-27": "G11826-P4266615713",
  "CELINA8823-11": "G11826-U6114574744",
  "CELINA8823-6": "G11826-X2964786751",
  "CELINA8823-8": "G11826-I9956516695",
  "CELINA8823-12": "G11826-V3735267393",
  "CELINA8823-3": "G11826-N1946600814",
  "CELINA8823-4": "G11826-X6005451923",
  "CELINA8823-1": "G11826-R2834648849",
  "CELINA8823-9": "G11826-E5587520215",
  "CELINA8823-7": "G11826-W4593875725",
  "CELINA8823-19": "G11826-Y9413098826",
  "CELINA8823-13": "G11826-P5972343233",
  "CELINA8823-10": "G11826-Y2686565129",
  "CELINA8823-2": "G11826-N9063528337",
  "CELINA8823-5": "G11826-Y8625732198",
  "LIANA2023-37": "G11826-B6016337361",
  "LUCIANA2023-52": "G11826-D1662440292",
};

/**
 * 获取所有商品编码列表（用于搜索）
 * @returns {Array} [{ productCode: string, goodcangCode: string }]
 */
export function getAllProductCodes() {
  return Object.entries(goodcangSkuMapping).map(([productCode, goodcangCode]) => ({
    productCode,
    goodcangCode
  }));
}

/**
 * 标准化编码，去掉前导零（8823-02 -> 8823-2）
 * @param {string} code
 * @returns {string}
 */
function normalizeLeadingZeros(code) {
  if (!code) return '';
  // 将 8823-02 转为 8823-2，但保留 A5018-05 这种
  return code.replace(/-0+(\d+)/g, '-$1');
}

/**
 * 搜索商品编码
 * @param {string} keyword - 搜索关键词
 * @returns {Array} 匹配的商品列表 [{ productCode, goodcangCode }]
 */
export function searchProductCodes(keyword) {
  if (!keyword || keyword.trim() === '') {
    return getAllProductCodes().slice(0, 20); // 返回前20个
  }
  
  const searchKey = keyword.toUpperCase().trim();
  // 标准化搜索关键词（去掉前导零）
  const normalizedSearchKey = normalizeLeadingZeros(searchKey);
  // 去掉横线的版本
  const searchKeyNoDash = searchKey.replace(/-/g, '');
  const normalizedSearchKeyNoDash = normalizedSearchKey.replace(/-/g, '');
  
  const results = [];
  
  for (const [productCode, goodcangCode] of Object.entries(goodcangSkuMapping)) {
    const upperCode = productCode.toUpperCase();
    const normalizedCode = normalizeLeadingZeros(upperCode);
    const codeNoDash = upperCode.replace(/-/g, '');
    const normalizedCodeNoDash = normalizedCode.replace(/-/g, '');
    
    // 多种匹配方式
    if (
      // 原始匹配
      upperCode.includes(searchKey) || 
      // 去前导零匹配
      normalizedCode.includes(normalizedSearchKey) ||
      // 去横线匹配
      codeNoDash.includes(searchKeyNoDash) ||
      normalizedCodeNoDash.includes(normalizedSearchKeyNoDash) ||
      // 只用数字部分匹配（提取搜索词中的数字）
      (searchKey.match(/\d+-?\d*/)?.[0] && upperCode.includes(searchKey.match(/\d+-?\d*/)[0])) ||
      // 谷仓编码匹配
      goodcangCode.toUpperCase().includes(searchKey)
    ) {
      results.push({ productCode, goodcangCode });
    }
  }
  
  return results.slice(0, 50); // 最多返回50个
}

/**
 * 根据商品标题/SKU查找谷仓商品条码
 * 核心逻辑：从商品名称中提取数字编码（如 8823-2），然后在映射表中查找包含该编码的key
 * 支持前导零匹配：8823-02 和 8823-2 视为相同
 * @param {string} title - 商品标题
 * @param {string} sku - 商品SKU
 * @param {string} variantTitle - 变体标题
 * @returns {object} { found: boolean, productCode: string, goodcangCode: string }
 */
export function findGoodcangSku(title, sku, variantTitle) {
  // 合并所有可能包含编码的字符串
  const allText = [title, sku, variantTitle].filter(Boolean).join(' ');
  
  // 从文本中提取数字编码（如 8823-2, 8823-02, A5018-31, 1908-35, K1020 等）
  const extractedCodes = [];
  
  // 匹配各种编码格式
  const patterns = [
    /\b([A-Z]?\d{3,5})-(\d{1,3})\b/gi,  // 8823-2, 8823-02, A5018-31, 1908-35
    /\b([A-Z]\d{3,5})\b/gi,              // K1020, K1019
    /\b(\d{4})-(\d{1,2})\b/gi,           // 1802-7, 2020-11
  ];
  
  for (const pattern of patterns) {
    const matches = allText.matchAll(pattern);
    for (const match of matches) {
      const code = match[0].toUpperCase();
      extractedCodes.push(code);
      // 同时添加去掉前导零的版本
      const normalizedCode = normalizeLeadingZeros(code);
      if (normalizedCode !== code) {
        extractedCodes.push(normalizedCode);
      }
    }
  }
  
  // 提取产品名（第一个英文单词）
  const productNameMatch = title?.match(/^([A-Za-z]+)/);
  const productName = productNameMatch ? productNameMatch[1].toUpperCase() : '';
  
  // 第一轮：精确匹配 - SKU直接匹配
  if (sku && goodcangSkuMapping[sku.toUpperCase()]) {
    return {
      found: true,
      productCode: sku.toUpperCase(),
      goodcangCode: goodcangSkuMapping[sku.toUpperCase()]
    };
  }
  
  // 第二轮：用提取的编码在映射表中查找
  for (const code of extractedCodes) {
    // 在所有映射key中查找包含该编码的项
    for (const [key, value] of Object.entries(goodcangSkuMapping)) {
      const normalizedKey = normalizeLeadingZeros(key.toUpperCase()).replace(/-/g, '');
      const normalizedCode = normalizeLeadingZeros(code).replace(/-/g, '');
      
      // 检查key是否以该编码结尾或包含该编码
      if (normalizedKey.endsWith(normalizedCode) || 
          normalizedKey.includes(normalizedCode) ||
          normalizeLeadingZeros(key.toUpperCase()).includes(normalizeLeadingZeros(code))) {
        // 额外验证：如果有产品名，优先匹配产品名相同的
        if (productName && key.toUpperCase().startsWith(productName)) {
          return {
            found: true,
            productCode: key,
            goodcangCode: value
          };
        }
      }
    }
    
    // 如果没有产品名匹配，尝试任意匹配
    for (const [key, value] of Object.entries(goodcangSkuMapping)) {
      const normalizedKey = normalizeLeadingZeros(key.toUpperCase()).replace(/-/g, '');
      const normalizedCode = normalizeLeadingZeros(code).replace(/-/g, '');
      
      if (normalizedKey.endsWith(normalizedCode) || 
          normalizeLeadingZeros(key.toUpperCase()).includes(normalizeLeadingZeros(code))) {
        return {
          found: true,
          productCode: key,
          goodcangCode: value
        };
      }
    }
  }
  
  // 第三轮：尝试组合产品名 + 数字编码
  if (productName) {
    for (const code of extractedCodes) {
      const normalizedCode = normalizeLeadingZeros(code);
      
      // 尝试 CELINA8823-2 格式
      const combinedCode1 = `${productName}${code}`;
      const combinedCode1Norm = `${productName}${normalizedCode}`;
      if (goodcangSkuMapping[combinedCode1]) {
        return {
          found: true,
          productCode: combinedCode1,
          goodcangCode: goodcangSkuMapping[combinedCode1]
        };
      }
      if (goodcangSkuMapping[combinedCode1Norm]) {
        return {
          found: true,
          productCode: combinedCode1Norm,
          goodcangCode: goodcangSkuMapping[combinedCode1Norm]
        };
      }
      
      // 尝试 CELINA-8823-2 格式
      const combinedCode2 = `${productName}-${code}`;
      const combinedCode2Norm = `${productName}-${normalizedCode}`;
      if (goodcangSkuMapping[combinedCode2]) {
        return {
          found: true,
          productCode: combinedCode2,
          goodcangCode: goodcangSkuMapping[combinedCode2]
        };
      }
      if (goodcangSkuMapping[combinedCode2Norm]) {
        return {
          found: true,
          productCode: combinedCode2Norm,
          goodcangCode: goodcangSkuMapping[combinedCode2Norm]
        };
      }
    }
  }
  
  return {
    found: false,
    productCode: extractedCodes[0] || '',
    goodcangCode: ''
  };
}

/**
 * 批量查找商品的谷仓编码
 * @param {Array} items - 商品列表 [{ title, sku, variantTitle, quantity }]
 * @returns {Array} 带谷仓编码的商品列表
 */
export function findGoodcangSkuBatch(items) {
  return items.map(item => {
    const result = findGoodcangSku(item.title, item.sku, item.variantTitle);
    return {
      ...item,
      ...result
    };
  });
}
